Filters
=======

Фильтры необходимы для обработки запросов из блока ``query`` в :ref:`Query in Query`.

Каждому фильтру должен соответствовать блок с запросом в ``query``, в противном случае фильтр не будет работать.

JSON-файл с фильтрами создаётся в папке с представлением и именуется по следующему принципу::
    
    наименование_представления.filters.json

Например::

    project_view.filters.json

..  thumbnail:: images/filters-1-naming-example.png
    :alt: Пример наименования
    :width: 50%
    :class: framed

Структура фильтров
------------------

Общий вид JSON-файла с фильтрами:

..  code-block:: json

    [
        {
            "icon": "...",
            "type": "...",
            "title": "...",
            "params": [
                    {
                            "name": "...",
                            "value": "..."
                    }
            ],
            "inSidebar": false,
            "placeholder": "..."
        }
    ]

IViewFilter
+++++++++++

Общая модель данных для фильтров.

..	code-block:: typescript

	export interface IViewFilter {
		title: string;
		placeholder?: string;
		viewId?: string;
		fields?: string[];
		type: VIEW_FILTER_TYPE;
		icon: string;
		multiple?: boolean;
		inSidebar?: boolean;
		params: IViewFilterParameter[];
	}

..  list-table::
    :widths: 10 90
    :header-rows: 1
    :align: left

    *   - Поле
        - Определение
    *   - ``title``
        - Название фильтра, которое будет видеть пользователь.
    *   - ``placeholder``
        - Заглушка для фильтра.
    *   - ``viewId``
        - В поле записывается наименование представления, если тип фильтра --- ``view``.
    *   - ``fields``
        - Поля формы или справочника, к которым применяется фильтр.
    *   - ``type``
        - В этом поле определяется тип фильтра. Подробнее о них :ref:`ниже<Filter Type>`.
    *   - ``icon``
        - В этом поле записывается наименование иконки для фильтра. Само наименование берётся из библиотеки иконок.
    *   - ``multiple``
        - Этот параметр отвечает за множественный выбор. Если значение ``true``, то за раз можно выбрать несколько фильтров.
    *   - ``inSidebar``
        - Этот параметр работает с боковым меню. Если значение ``true``, то у представления появится боковое меню.
          Данные для этого меню берутся из значений фильтра.
    *   - ``params``
        - В этом блоке описываются параметры, относительно которых совершаются запросы при фильтрации.
    
        

IViewFilterParameter
++++++++++++++++++++

Модель данных для параметров фильтра.

..	code-block:: typescript

	export interface IViewFilterParameter {
		name: string;
		value?: string | object | object[];
	}

..  list-table::
    :widths: 10 90
    :header-rows: 1
    :align: left

    *   - Поле
        - Определение
    *   - ``name``
        - Название переменной из поля ``value`` в **Query**.
    *   - ``value``
        - Изначальное значение фильтра, которое задаётся прикладным программистом. Необходимо для работы заготовленных фильтров.
          Если значение фильтра не должно быть определено, то поле можно либо не заполнять, либо заполнить пустой строкой ``""``.
          
          В поле можно передавать строку, объект или массив объектов.
          

..  _Filter Type:

VIEW_FILTER_TYPE
++++++++++++++++

..	code-block:: typescript

	export enum VIEW_FILTER_TYPE {
		TEXT = "text",
		VIEW = "view",
		DATE = "date",
		SWITCH = "switch",
	}

..  list-table::
    :widths: 10 90
    :header-rows: 1
    :align: left

    *   - Поле
        - Определение
    *   - ``TEXT``
        - Простой текстовый фильтр, который можно использовать для поиска по словам или номеру.
    *   - ``VIEW``
        - Фильтр созданный на основе какого-то другого представления.
          Например, если замечания нужно отфильтровать по участкам на объекте строительства.
    *   - ``DATE``
        - Фильтрация по дате. В ``value`` параметров для такого фильтра обычно передаётся массив объектов с ключами ``end`` и ``start``.
    *   - ``SWITCH``
        - Это фильтр-переключатель (чекбокс). Удобен в работе с заготовленными фильтрами. Например, если пользователю необходимо
          отфильтровать экземпляры формы, которые созданы им.