Аналитические графики
=====================

Для отображения аналитических графиков используется Grafana.

Описание рабочего пространства Grafana
--------------------------------------

Рабочее пространство состоит из нескольких элементов:

#.  Область ввода запроса. Поле в которое вводится запрос PostgreSQL, на основе которого должен формироваться график.
    При создании нового графика в поле “Format as” выбирается один из двух вариантов:

    *   “Time series” --- для графиков, которые будут отображать значения разбитые по временным отрезкам
    *   “Table” --- для графиков, не группируемых по временным отрезкам

    После нужно нажать на кнопку “Edit SQL”, находящуюся рядом. Далее откроется поле для ввода запроса.
    Ниже располагается кнопка “+ Query” для создания нового поля для ввода запроса.

#.  Скрываемое поле опций. Поле позволяющее конфигурировать график. Представляет собой список сгруппированных по типам настроек.
    Основная настройка это “Visualization”, в которой можно выбрать внешний вид графика. 

    Поле открывается кнопкой “Show options” в правом верхнем углу и закрывается кнопкой “>”, располагающейся там же.

#.  Область фильтров. Область в которой отображаются прописанные фильтры, которые влияют на график (в том случае если данные фильтры прописаны в запросе).
    По дефолту установлен фильтр по времени.
    Остальные фильтры необходимо прописывать вручную, если в этом есть необходимость (про создание фильтров далее). 

    Также в этой области присутствует набор кнопок “Fill/Fit/Exact”, отвечающие за размер области отображения графика.
    Правее временного фильтра распологается кнопка обновления отображаемых данных и ниспадающий список с выбором промежутка времени,
    через каждый из которых будет происходить авоматическое обновление.

#.  Область графика/отображения данных. Область, где отображается результат запроса, с учетом выставленных фильтров и в формате, настроенном в поле опций.
#.  Верхняя панель. Область содержащая несколько кнопок с общими для панели и дашборда действиями:

    #.  ⚙️ (”Open dashboard settings”) - открыть настройки дашборда
    #.  “Discard” - отменить изменения и закрыть страницу графика
    #.  “Save” - сохранить дашборд
    #.  “Apply” - применить изменения графика и перейти на страницу дашборда (без сохранения дашборда)

Создание фильтров для дашборда
------------------------------

Иногда временного фильтра может не хватать для определенных метрик.
В таком случае можно создать собственные фильтры (фильтры создаются не для конкретного графика, а для всего дашборда).
Для этого в вверхней панели выбираем ⚙️ (”Open dashboard settings”).
В боковом меню открывшейся страницы нажимаем “Variables” и открывается страница редактирования фильтров
(для того чтобы эта страница работала необходимо чтобы в области запроса был введен запрос;
если запрос есть то по дефолту тут пусто). Для создания нового фильтра нажимаем кнопку “New”. 

Открывается страница для заполнения данных фильтра, содержащая следующие поля:

*   “Name” - имя фильтра, к которому можно обратится в запросе
*   “Type” - формат получения данных (запросом, вводимые списком значения и т.д.)
*   “Label” - имя фильтра, отображаемое на панели фильтров
*   “Hide” - поле, в котором указывается, что скрыть на панели. Всего 3 варианта: ничего не скрывать (” ”),
    скрыть название фильтра (”Label”) или скрыть весь фильтр (”Variable”)
*   “{Type} Options” -  поле для ввода данных в зависимости от типа фильтра
    (для “Query” это запрос, база из которой берутся данные и сортировки; для “Custom” это поле для ввода значений и т.д.) 
*   “Selection Options” - поле с 2 настройками выбора данных: возмоность множественного выбора (”Multi-value”)
    и добавление поля “Выбрать все” (”Include All option”)

После заполнения всех полей нажимаем кнопку “Add” и теперь в области фильтров отображается (если в поле “Hide” не выбранно “Variable”) новый фильтр.